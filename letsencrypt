#!/usr/bin/env bash
# Updates nginx letsencrypt domains by server_name.

/opt/letsencrypt/letsencrypt-auto \
  certonly -a webroot --webroot-path=/var/www/ssl \
  $(grep -hro '^\s*server_name\s\+[a-zA-Z0-9.-]\+' /etc/nginx/ |
    sort | uniq | awk '{print "-d", $2}')
