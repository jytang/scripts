#!/usr/bin/env bash
# Fetch info about your system
#
# Created by Dylan Araps
# https://github.com/dylanaraps/dotfiles/
# Modified by Ethan Chan
# https://github.com/metakirby5/dotfiles/

# Text
title="$(whoami)"
underline="$(printf %"${#title}"s |tr " " "=")="

# Colors
primary=$(tput setaf 1)
secondary=$(tput setaf 4)
black=$(tput setaf 0)
bold=$(tput bold)
clear=$(tput sgr0)

put_colors() {
    for i in `seq $1 $2`; do
        echo -n "$(tput setab $i)    $clear "
    done
}

# Image
walltempdir=~/.fetch
width=312
height=312
yoffset=0
xoffset=0
pad="                       "

# If no image provided
if [ -z "$img" ]; then
    # Image shall be the wallpaper
    wallpaper="$(cat ~/.fehbg | cut -d\' -f2)"
    img="$walltempdir/$(basename $wallpaper)"

    # Crop if necessary
    if [ ! -f "$img" ]; then
        [ ! -d "$walltempdir" ] && (mkdir "$walltempdir" || exit)
        size="$(identify -format '%h' $wallpaper)"
        convert -crop "$size"x"$size"+0+0 -gravity center "$wallpaper" -resize "$height"x"$height" "$img"
    fi
fi

# Print info
clear
tput civis
echo "${pad}${bold}${primary}$title${clear}"
echo "${pad}${bold}${black}${underline}"
echo "${pad}${bold}${secondary}OS${clear}: Fedora"
echo "${pad}${bold}${secondary}Shell${clear}: bash"
echo "${pad}${bold}${secondary}Window Manager${clear}: i3"
echo "${pad}${bold}${secondary}Font${clear}: PixelMPlus12"
echo "${pad}${bold}${secondary}Waifu${clear}: Black Rock Shooter"
echo
echo "${pad}$(put_colors 0 7)"
echo "${pad}$(put_colors 8 15)"
echo -e "0;1;$xoffset;$yoffset;$width;$height;;;;;$img\n4;\n3;" | /usr/lib/w3m/w3mimgdisplay
tput cnorm

